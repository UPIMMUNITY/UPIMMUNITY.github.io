# Initialize home-manager

## Pre-enable flake(Optional)

It's recommended to use home-manager together with flake enabled.
If you haven't enabled flake yet, do the following for single user:

```bash
echo 'experimental-features = nix-command flakes' >> ~/.config/nix/nix.conf
```

or the following for multi-users:

```bash
sudo sh -c 'echo "experimental-features = nix-command flakes" >> /etc/nix/nix.conf'
```

## Installation

### Add channel for home-manager

- Unstable

```bash
nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager && nix-channel --update
```

- Stable(24.05)

```bash
nix-channel --add https://github.com/nix-community/home-manager/archive/release-24.05.tar.gz home-manager && nix-channel --update
```

### Install

```bash
nix-shell '<home-manager>' -A install
```

:::info
`<home-manager>` is the channel alias you in previous step. Replace it by yours if necessary.
:::

After this command, `home-manager` should be available.

## Initialize home-manager

Initialize home-manager config by:

```bash
home-manager init
```

This command generates `flake.nix`, `home.nix` under `~/.config/home-manager/`

## Enable flake using home-manager

After setting up home-manager, we can manage nix with it, we don't need to sepcifiy any config in `nix.conf` any more! 
Home-manager will handle things for us.
So add the following to function body in `home.nix` to enable flakes instead of what we just do earlier in `nix.conf`.

```nix
nix = {
  # ...
  settings.experimental-features = ["nix-command" "flakes"];
};
```

## Apply config

If you're ready to restore config specified in `home.nix` to your machine

```bash
home-manager switch
```

This command uses `home.nix` and `flake.nix` under `~/.config/home-manager/` by default.

If you feel uncertain, try

```bash
home-manager build
```

This generates a folder named `result/` under `~/.config/home-manager/`

Currently we just tested the minimal config generated by home-manager, next we'll learn everything home-manager can do.
